{{- /* Interactive machine selection */ -}}
{{- $machines := list "gleason" "macbook" "rpi" "pc" "codespaces" -}}
{{- $machine := promptChoice "Select machine" $machines (get . "machine") -}}

{{- /* Prompt for machine and private data paths */ -}}
{{- $machinePath := promptString "Enter the machine path" (env "MACHINE" | default .chezmoi.workingTree) -}}
{{- $privatePath := promptString "Enter the private path" (env "MACHINE_PRIVATE" | default (get . "privatePath")) -}}

{{- /* Machine path variables */ -}}
{{- $configPath := printf "%s/config" $machinePath -}}
{{- $machinesPath := printf "%s/machines" $machinePath -}}
{{- $scriptsPath := printf "%s/scripts" $machinePath -}}

{{- /* Convenience path variables */ -}}
{{- $machineConfigPath := printf "%s/machines/%s" $machinePath $machine -}}

{{- /* Detect OS */ -}}
{{- $os := .chezmoi.os -}}
{{- if eq .chezmoi.os "linux" -}}
{{-   if (.chezmoi.kernel | lower | contains "microsoft") -}}
{{-     $os = "wsl" -}}
{{-   end -}}
{{- end -}}

# Chezmoi
sourceDir = {{ $machinePath | quote }}
workingTree = {{ $machinePath | quote }}
progress = true

[data] # ======================================================================


# Machine configuration
os = {{ $os | quote }}
arch = {{ .chezmoi.arch | quote }}
machine = {{ $machine | quote }}

# Deployment paths
machinePath = {{ $machinePath | quote }}
privatePath = {{ $privatePath | quote }}

# Machine paths
configPath = {{ $configPath | quote }}
machinesPath = {{ $machinesPath | quote }}
scriptsPath = {{ $scriptsPath | quote }}

# Convenience paths
machineConfigPath = {{ $machineConfigPath | quote }}
