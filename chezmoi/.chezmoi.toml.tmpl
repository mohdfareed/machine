# MARK: Prompts
# =============================================================================

{{- /* Interactive machine selection */ -}}
{{- $machines := list "gleason" "macbook" "rpi" "pc" "codespaces" -}}
{{- $machine := promptChoice "Select machine" $machines (get . "machine") -}}

{{- /* Prompt for machine path */ -}}
{{- $machinePath := promptString "Enter the machine path"
	(env "MACHINE" | default .chezmoi.workingTree)
-}}

{{- /* Prompt for private path */ -}}
{{- $privatePath := promptString "Enter the private path"
	(env "MACHINE_PRIVATE" | default (get . "privatePath"))
-}}

# MARK: Configuration
# =============================================================================

{{- /* Machine path variables */ -}}
{{- $configPath := printf "%s/config" $machinePath -}}
{{- $machineConfigPath := printf "%s/machines/%s" $machinePath $machine -}}
{{- $scriptsPath := printf "%s/scripts" $machinePath -}}

{{- /* Detect OS */ -}}
{{- $os := .chezmoi.os -}}
{{- if eq .chezmoi.os "linux" -}}
{{-   if (.chezmoi.kernel | lower | contains "microsoft") -}}
{{-     $os = "wsl" -}}
{{-   end -}}
{{- end -}}

# MARK: Chezmoi
# =============================================================================

sourceDir = {{ $machinePath | quote }}
workingTree = {{ $machinePath | quote }}
progress = true

# MARK: Configuration
# =============================================================================

[data]
os = {{ $os | quote }}
arch = {{ .chezmoi.arch | quote }}

# Deployment Config
machine = {{ $machine | quote }}
machinePath = {{ $machinePath | quote }}
privatePath = {{ $privatePath | quote }}

# Machine Paths
configPath = {{ $configPath | quote }}
machineConfigPath = {{ $machineConfigPath | quote }}
scriptsPath = {{ $scriptsPath | quote }}
